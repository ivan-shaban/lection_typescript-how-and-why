### `Typescript:` как и зачем мы его используем на проекте shop2.0

---

### содержание

- описание проекта
- предпосылки для перехода
- процесс миграции
- подведение итогов

---

### особенности проекта

@ul[spaced]
- shop2.0 это проект магазина внутриигрового клиента включающий большое кол-во интеграций с различными сервисами
- 80 000 строчек кода на фронтенде
- больше года активной разработки 
- команда 5+ человек
- к моменту интеграции проект уже был на 80% написан
- используется современный веб-стек технологий (`React16`, `Redux`, `Reselect`, etc)
@ulend

---

### предпосылки для перехода

- несколько источников данных, которые надо привести к единому виду
- высокий порог вхождения в проект
- сложный рефакторинг
- быстрое и непрозрачное устаревание тестов
- запутанные селекторы
- глубокая вложенность передачи данных по дереву компонентов

---

### почему именно `typescript`

---

### были рассмотрены технологии:

@ul[spaced]
- `typescript`
- `flow`
- какая-то-либа-для-функционального-программирования
@ulend

---

### преимущества перед конкурентами:

@ul[spaced]
- большое комьюнити
- хорошая документация
- четкий роадмап
- поддерживается `Microsoft`
- хорошая интеграция с наиболее популярными IDE
- большая база типизированных библиотек от сторонних разработчиков
- опциональная типизация
@ulend
// TODO: добавить анимированный пример валидации типов на примере функции normalizeData

---

### почему не использовали с начала проекта

- не было нужных специалистов на этапе старта проекта
- не было явных бенефитов от использования новой, неизвестной нам технологии
- завышенные ожидания о сложности изучения технологии
- требовался "быстрый старт" на основе прототипов

---

### процесс миграции

---

### порядок миграции

@ul[spaced]
- стейт
- источники данных (форматы ответов от различных сервисов)
- новые файлы
- редьюсеры и экшены 
- селекторы 
- компоненты и тесты
@ulend

---

### пошаговая миграция модуля

@ul[spaced]
- переименовать модуль изменив расширение файла
- типизировать аргументы функций
- если возвращаемый тип функции может вычислиться, то можно не обьявлять тип явно
- использовать где возможно готовые типы, если их нет использовать `any` или описать
- использовать `enum` где возможно
- пофиксить ошибки
- прогнать тесты и линтеры
- убедиться что все хорошо
- компонент мигрирован, поздравляю!
@ulend

---

### проблемы

@ul[spaced]
- `jest` не мог явно зарезолвить смешанные импорты (`.jsx?` \ `.tsx?`)
- `jest` проблемы с async тестами (неудобный синтаксис)
- `jest` проблема с моками (много бойлерплейта)
- `webpack` долго собирался 
- `reselect` нельзя использовать spread в старой версии библиотеки
- проблема с `postcss` переменными
- беспорядок с размещением интерфейсов
- не очевидная работа `enum` из коробки
- плагин локализации не поддерживает typescript
- стали больше писать кода
@ulend

---

### бенефиты

@ul[spaced]
- код стал более читаемым
- снижен порог входа в проект
- рефакторить стало проще
- сократилось время обнаружения ошибки
- повысилась надежность кодобазы
- повысилось удобство написания кода (автокомплит)
- практически не тратится время на ручное отслеживание зависимостей, когда ты искал где метод вызывается, какие параметры в него передаются и т.д., что бы определить насколько правильно он используется в целом
@ulend

---

@ul[spaced]
- все проверки типов выполняются на этапе компиляции, а не на рантайме, частично это замена `PropTypes`, частично `immutablejs`
- `generics` и вычисляемые типы, очень сильно развязывают руки, позволяя очень гибко описывать зависимости (например у нас тип `RootState`, вычисляется на основании обьектов из которых он состоит)
- работа со сторонними сервисами и стейтом стала простой и прозрачной
- работа с `css` стала более прозрачной (есть список все классов для компонента)
- юниттесты покрывают актуальное состояние тестируемых обьектов
- стали меньше писать кода
@ulend

---

### посмортем

---

### общие выводы

- typescript не замена юниттестам!
- юниттесты нужны

---

### планы на будущее

- strictNullChecks
- strictBindCallApply
- `web2client` на typescript
- `react-wot-bootstrap` на typescript

---

### Вопросы?

---

### Спасибо!
