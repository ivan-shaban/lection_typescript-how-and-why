### Typescript: как и зачем мы его используем на проекте shop2.0

---

### Содержание

- описание проекта
- предпосылки для перехода на `typescript`
- процесс миграции
- подведение итогов

---

### Особенности проекта

- shop2.0 это проект магазина внутриигрового клиента включающий большое кол-во интеграций с различными сервисами
@ul[spaced]
- 80 000 строчек кода на фронтенде
- больше года активной разработки 
- команда 5+ человек
- к моменту интеграции проект уже был на 80% написан
- используется современный веб-стек технологий (React16, Redux, Reselect, etc)
@ulend

---

### предпосылки для перехода на `typescript`

- несколько источников данных, которые надо привести к единому виду
- высокий порог вхождения в проект
- сложный рефакторинг
- быстрое и непрозрачное устаревание тестов
- запутанные селекторы
- глубокая вложенность передачи данных по дереву компонентов

---

### почему именно `typescript`

- были рассмотрены технологии:
@ul[spaced]
- `typescript`
- `flow`
- какая-то-либа-для-функционального-программирования, которую я почти сразу отмел как неподходящую по концепции
@ulend

- остановились на `typescript`, т.к. по сравнению с конкурентами были следующие преимущества:
@ul[spaced]
- большое комьюнити
- хорошая документация
- четкий роадмап
- поддерживается `Microsoft`
- хорошая интеграция с наиболее популярными IDE
- большая база типизированных библиотек от сторонних разработчиков
- опциональная типизация
@ulend
// TODO: добавить анимированный пример валидации типов на примере функции normalizeData
---

### почему не использовали `typescript` с начала проекта

- не было специалистов по `typescript` на этапе старта проекта
- не было явных бенефитов от использования новой, неизвестной технологии
- завышенные ожидания на трата на изучение технологии и набивание шишек
- требовался "быстрый старт" на основе прототипов

---

### миграции на `typescript`

---

### порядок миграции

- стейт
- источники данных (форматы ответов от различных сервисов)
- новые файлы
- редьюсеры и экшены 
- селекторы 
- компоненты и тесты

---

### пошаговая миграция модуля

- переименовать модуль изменим расширение файла
- типизировать аргументы функций
- использовать где возможно готовые типы, если их нет использовать `any` или описать
- использовать `enum` где возможно
- пофиксить ошибки
- прогнать тесты и линтеры
- убедиться что все хорошо
- компонент мигрирован, поздравляю!

---

### проблемы с которыми сталкивались

- `jest` не мог явно зарезолвить смешанные импорты (`.jsx?` \ `.tsx?`)
- `jest` проблемы с async тестами (неудобный синтаксис)
- `jest` проблема с моками (много бойлерплейта)
- `webpack` долго собирался 
- `reselect` нельзя использать spread в старой версии библиотеки
- проблема `postcss` переменными
- беспорядок с размещением интерфейсов
- не очевидная работа `enum` из коробки
- плагин локализации не поддерживает `typescript`
- стали больше писать кода

---

### бенефиты которые получили

- код стал более читаемым
- снижен порог входа в проект
- рефакторить стало проще
- сократилось время обнаружения ошибки
- повысилась надежность кодобазы
- повысилось удобство написания кода (автокомплит)
- практически не тратится время на ручное отслеживание зависимостей, когда ты искал где метод вызывается, какие параметры в него передаются и т.д., что бы определить насколько правильно он используется в целом
- все проверки типов выполняются на этапе компиляции, а не на рантайме, частично это замена `PropTypes`, частично `immutablejs`
- `generics` и вычисляемые типы, очень сильно развязывают руки, позволяя очень гибко описывать зависимости (например у нас тип `RootState`, вычисляется на основании обьектов из которых он состоит)
- работа со сторонними сервисами и стейтом стала простой и прозрачной
- работа с `css` стала более прозрачной (есть список все классов для компонента)
- юниттесты покрывают актуальное состояние тестируемых обьектов
- стали меньше писать кода

---

### посмортем о процессе внедрения

---

### общие выводы от внедрения и использования технологии

- `typescript` не замена юниттестам!
- юниттесты нужны

---

### планы на будущее

- strictNullChecks
- strictBindCallApply
- `web2client` на `typescript`
- `react-wot-bootstrap` на `typescript`

---

### Вопросы?

---

### Спасибо!
